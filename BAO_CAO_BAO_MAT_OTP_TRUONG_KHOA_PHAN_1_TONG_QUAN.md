# BÃO CÃO Báº¢O Máº¬T CHUYÃŠN SÃ‚U: ÄÄ‚NG NHáº¬P OTP CHO TÃ€I KHOáº¢N TRÆ¯á»NG KHOA

## Má»¤C Lá»¤C

1. [Tá»•ng quan vá» há»‡ thá»‘ng](#1-tá»•ng-quan-vá»-há»‡-thá»‘ng)
2. [KhÃ¡i niá»‡m OTP vÃ  xÃ¡c thá»±c hai yáº¿u tá»‘](#2-khÃ¡i-niá»‡m-otp-vÃ -xÃ¡c-thá»±c-hai-yáº¿u-tá»‘)
3. [Táº¡i sao cáº§n OTP cho trÆ°á»Ÿng khoa?](#3-táº¡i-sao-cáº§n-otp-cho-trÆ°á»Ÿng-khoa)
4. [Kiáº¿n trÃºc há»‡ thá»‘ng](#4-kiáº¿n-trÃºc-há»‡-thá»‘ng)
5. [CÃ¡c thÃ nh pháº§n chÃ­nh](#5-cÃ¡c-thÃ nh-pháº§n-chÃ­nh)

---

## 1. Tá»”NG QUAN Vá»€ Há»† THá»NG

### 1.1. Há»‡ thá»‘ng LMS (Learning Management System)

Há»‡ thá»‘ng LMS lÃ  má»™t á»©ng dá»¥ng quáº£n lÃ½ há»c táº­p cho phÃ©p:
- **TrÆ°á»Ÿng khoa (Dean)**: Quáº£n lÃ½ toÃ n bá»™ há»‡ thá»‘ng, táº¡o giáº£ng viÃªn, sinh viÃªn, lá»›p há»c, khÃ³a há»c
- **Giáº£ng viÃªn (Lecturer)**: Quáº£n lÃ½ lá»›p há»c, cháº¥m Ä‘iá»ƒm, giao tiáº¿p vá»›i sinh viÃªn
- **Sinh viÃªn (Student)**: Xem Ä‘iá»ƒm, Ä‘Äƒng kÃ½ lá»›p, giao tiáº¿p vá»›i giáº£ng viÃªn

### 1.2. Váº¥n Ä‘á» báº£o máº­t

TrÆ°á»Ÿng khoa cÃ³ quyá»n cao nháº¥t trong há»‡ thá»‘ng, cÃ³ thá»ƒ:
- Táº¡o/xÃ³a/sá»­a táº¥t cáº£ tÃ i khoáº£n
- Quáº£n lÃ½ toÃ n bá»™ dá»¯ liá»‡u há»c táº­p
- Xem vÃ  chá»‰nh sá»­a Ä‘iá»ƒm sá»‘
- Quáº£n lÃ½ há»c phÃ­

**Náº¿u tÃ i khoáº£n trÆ°á»Ÿng khoa bá»‹ xÃ¢m nháº­p, toÃ n bá»™ há»‡ thá»‘ng sáº½ bá»‹ áº£nh hÆ°á»Ÿng nghiÃªm trá»ng!**

### 1.3. Giáº£i phÃ¡p: XÃ¡c thá»±c hai yáº¿u tá»‘ (2FA) vá»›i OTP

Äá»ƒ báº£o vá»‡ tÃ i khoáº£n trÆ°á»Ÿng khoa, há»‡ thá»‘ng yÃªu cáº§u:
1. **Yáº¿u tá»‘ 1**: Username + Password (cÃ¡i báº¡n biáº¿t)
2. **Yáº¿u tá»‘ 2**: MÃ£ OTP gá»­i qua email (cÃ¡i báº¡n cÃ³)

Chá»‰ khi cÃ³ Cáº¢ HAI yáº¿u tá»‘, trÆ°á»Ÿng khoa má»›i cÃ³ thá»ƒ Ä‘Äƒng nháº­p.

---

## 2. KHÃI NIá»†M OTP VÃ€ XÃC THá»°C HAI Yáº¾U Tá»

### 2.1. OTP lÃ  gÃ¬?

**OTP (One-Time Password)** = Máº­t kháº©u má»™t láº§n

- LÃ  má»™t chuá»—i sá»‘ ngáº«u nhiÃªn (thÆ°á»ng 6 chá»¯ sá»‘)
- Chá»‰ sá»­ dá»¥ng Ä‘Æ°á»£c **Má»˜T Láº¦N DUY NHáº¤T**
- CÃ³ **thá»i gian háº¿t háº¡n** (thÆ°á»ng 5-10 phÃºt)
- ÄÆ°á»£c gá»­i qua email hoáº·c SMS

**VÃ­ dá»¥**: Báº¡n nháº­n Ä‘Æ°á»£c email vá»›i mÃ£ `123456`. Báº¡n nháº­p mÃ£ nÃ y Ä‘á»ƒ Ä‘Äƒng nháº­p. Sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng, mÃ£ nÃ y khÃ´ng cÃ²n dÃ¹ng Ä‘Æ°á»£c ná»¯a.

### 2.2. XÃ¡c thá»±c hai yáº¿u tá»‘ (2FA - Two-Factor Authentication)

**2FA** lÃ  phÆ°Æ¡ng phÃ¡p báº£o máº­t yÃªu cáº§u **2 yáº¿u tá»‘ khÃ¡c nhau** Ä‘á»ƒ xÃ¡c thá»±c:

1. **Yáº¿u tá»‘ 1 - CÃ¡i báº¡n biáº¿t (Something you know)**:
   - Máº­t kháº©u
   - CÃ¢u há»i báº£o máº­t
   - PIN

2. **Yáº¿u tá»‘ 2 - CÃ¡i báº¡n cÃ³ (Something you have)**:
   - MÃ£ OTP qua email/SMS
   - á»¨ng dá»¥ng xÃ¡c thá»±c (Google Authenticator)
   - Thiáº¿t bá»‹ váº­t lÃ½ (USB key)

3. **Yáº¿u tá»‘ 3 - CÃ¡i báº¡n lÃ  (Something you are)** (tÃ¹y chá»n):
   - VÃ¢n tay
   - Nháº­n diá»‡n khuÃ´n máº·t
   - Giá»ng nÃ³i

### 2.3. Táº¡i sao 2FA an toÃ n hÆ¡n?

**Ká»‹ch báº£n táº¥n cÃ´ng khÃ´ng cÃ³ 2FA:**
```
Káº» táº¥n cÃ´ng â†’ ÄÃ¡nh cáº¯p máº­t kháº©u â†’ ÄÄƒng nháº­p thÃ nh cÃ´ng â†’ XÃ¢m nháº­p há»‡ thá»‘ng
```

**Ká»‹ch báº£n táº¥n cÃ´ng cÃ³ 2FA:**
```
Káº» táº¥n cÃ´ng â†’ ÄÃ¡nh cáº¯p máº­t kháº©u â†’ ÄÄƒng nháº­p bÆ°á»›c 1 â†’ Cáº§n mÃ£ OTP
â†’ KhÃ´ng cÃ³ quyá»n truy cáº­p email â†’ KHÃ”NG THá»‚ Ä‘Äƒng nháº­p â†’ THáº¤T Báº I
```

**Lá»£i Ã­ch:**
- Ngay cáº£ khi máº­t kháº©u bá»‹ lá»™, káº» táº¥n cÃ´ng váº«n khÃ´ng thá»ƒ Ä‘Äƒng nháº­p
- MÃ£ OTP chá»‰ cÃ³ hiá»‡u lá»±c trong thá»i gian ngáº¯n
- MÃ£ OTP chá»‰ dÃ¹ng Ä‘Æ°á»£c má»™t láº§n
- MÃ£ OTP Ä‘Æ°á»£c gá»­i Ä‘áº¿n email mÃ  chá»‰ chá»§ tÃ i khoáº£n má»›i cÃ³ quyá»n truy cáº­p

---

## 3. Táº I SAO Cáº¦N OTP CHO TRÆ¯á»NG KHOA?

### 3.1. Quyá»n háº¡n cao

TrÆ°á»Ÿng khoa cÃ³ quyá»n:
- âœ… Táº¡o/xÃ³a/sá»­a táº¥t cáº£ tÃ i khoáº£n (giáº£ng viÃªn, sinh viÃªn)
- âœ… Xem vÃ  chá»‰nh sá»­a Ä‘iá»ƒm sá»‘ cá»§a táº¥t cáº£ sinh viÃªn
- âœ… Quáº£n lÃ½ há»c phÃ­
- âœ… Quáº£n lÃ½ lá»›p há»c, khÃ³a há»c, há»c ká»³
- âœ… Xem bÃ¡o cÃ¡o thá»‘ng kÃª toÃ n há»‡ thá»‘ng

### 3.2. Rá»§i ro náº¿u bá»‹ xÃ¢m nháº­p

Náº¿u tÃ i khoáº£n trÆ°á»Ÿng khoa bá»‹ hack:
- âŒ Káº» táº¥n cÃ´ng cÃ³ thá»ƒ táº¡o tÃ i khoáº£n giáº£
- âŒ CÃ³ thá»ƒ thay Ä‘á»•i Ä‘iá»ƒm sá»‘
- âŒ CÃ³ thá»ƒ xÃ³a dá»¯ liá»‡u quan trá»ng
- âŒ CÃ³ thá»ƒ truy cáº­p thÃ´ng tin cÃ¡ nhÃ¢n cá»§a táº¥t cáº£ ngÆ°á»i dÃ¹ng
- âŒ CÃ³ thá»ƒ gÃ¢y thiá»‡t háº¡i khÃ´ng thá»ƒ kháº¯c phá»¥c

### 3.3. So sÃ¡nh vá»›i cÃ¡c vai trÃ² khÃ¡c

| Vai trÃ² | Quyá»n háº¡n | CÃ³ OTP? | LÃ½ do |
|---------|-----------|---------|-------|
| **TrÆ°á»Ÿng khoa** | ToÃ n quyá»n há»‡ thá»‘ng | âœ… CÃ³ | Quyá»n cao nháº¥t, cáº§n báº£o vá»‡ tá»‘i Ä‘a |
| **Giáº£ng viÃªn** | Quáº£n lÃ½ lá»›p há»c, cháº¥m Ä‘iá»ƒm | âŒ KhÃ´ng | Quyá»n háº¡n giá»›i háº¡n trong lá»›p há»c cá»§a mÃ¬nh |
| **Sinh viÃªn** | Xem Ä‘iá»ƒm, Ä‘Äƒng kÃ½ lá»›p | âŒ KhÃ´ng | Quyá»n háº¡n ráº¥t háº¡n cháº¿, chá»‰ xem thÃ´ng tin cÃ¡ nhÃ¢n |

---

## 4. KIáº¾N TRÃšC Há»† THá»NG

### 4.1. SÆ¡ Ä‘á»“ tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend  â”‚ â—„â”€â”€â”€â”€â”€â–º â”‚   Backend   â”‚ â—„â”€â”€â”€â”€â”€â–º â”‚  Database   â”‚
â”‚  (React)    â”‚  HTTP   â”‚  (FastAPI)  â”‚  SQL    â”‚ (PostgreSQL) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ SMTP
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ Email Serverâ”‚
                       â”‚  (Gmail)    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2. CÃ¡c thÃ nh pháº§n

1. **Frontend (React + TypeScript)**
   - Giao diá»‡n Ä‘Äƒng nháº­p
   - Trang xÃ¡c thá»±c OTP
   - Quáº£n lÃ½ token JWT

2. **Backend (FastAPI + Python)**
   - API xá»­ lÃ½ Ä‘Äƒng nháº­p
   - Táº¡o vÃ  xÃ¡c thá»±c OTP
   - Gá»­i email OTP
   - Táº¡o JWT token

3. **Database (PostgreSQL)**
   - LÆ°u trá»¯ thÃ´ng tin ngÆ°á»i dÃ¹ng
   - LÆ°u trá»¯ OTP táº¡m thá»i (trong bá»™ nhá»›)

4. **Email Server (Gmail SMTP)**
   - Gá»­i email chá»©a mÃ£ OTP

---

## 5. CÃC THÃ€NH PHáº¦N CHÃNH

### 5.1. Backend Components

#### a) Router: `lms_backend/app/routers/auth.py`
- Xá»­ lÃ½ cÃ¡c endpoint Ä‘Äƒng nháº­p
- `/auth/login` - ÄÄƒng nháº­p ban Ä‘áº§u
- `/auth/verify-otp` - XÃ¡c thá»±c OTP
- `/auth/resend-otp` - Gá»­i láº¡i OTP

#### b) Service: `lms_backend/app/services/otp_service.py`
- `generate_otp()` - Táº¡o mÃ£ OTP ngáº«u nhiÃªn
- `store_otp()` - LÆ°u OTP vá»›i thá»i gian háº¿t háº¡n
- `verify_otp()` - XÃ¡c thá»±c OTP
- `send_otp_email()` - Gá»­i email chá»©a OTP

#### c) Security: `lms_backend/app/auth/security.py`
- `verify_password()` - Kiá»ƒm tra máº­t kháº©u
- `create_access_token()` - Táº¡o JWT token
- `decode_access_token()` - Giáº£i mÃ£ JWT token

#### d) Config: `lms_backend/app/core/config.py`
- Cáº¥u hÃ¬nh SMTP (email server)
- Cáº¥u hÃ¬nh OTP (Ä‘á»™ dÃ i, thá»i gian háº¿t háº¡n)
- Cáº¥u hÃ¬nh JWT (secret key, thá»i gian háº¿t háº¡n)

### 5.2. Frontend Components

#### a) Page: `lms_frontend/src/pages/Login.tsx`
- Form Ä‘Äƒng nháº­p
- Xá»­ lÃ½ pháº£n há»“i tá»« server
- Chuyá»ƒn hÆ°á»›ng Ä‘áº¿n trang OTP náº¿u cáº§n

#### b) Page: `lms_frontend/src/pages/OtpVerify.tsx`
- Form nháº­p OTP
- Gá»­i OTP Ä‘á»ƒ xÃ¡c thá»±c
- NÃºt gá»­i láº¡i OTP

#### c) Context: `lms_frontend/src/context/AuthContext.tsx`
- Quáº£n lÃ½ tráº¡ng thÃ¡i Ä‘Äƒng nháº­p
- LÆ°u trá»¯ token JWT
- Cung cáº¥p hÃ m login/logout

#### d) Service: `lms_frontend/src/services/api.ts`
- Cáº¥u hÃ¬nh axios
- Tá»± Ä‘á»™ng thÃªm JWT token vÃ o header
- Xá»­ lÃ½ lá»—i 401 (unauthorized)

### 5.3. Database Models

#### Model: `lms_backend/app/models/user.py`
- Báº£ng `users`: LÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ng
  - `id`: ID ngÆ°á»i dÃ¹ng
  - `username`: TÃªn Ä‘Äƒng nháº­p
  - `email`: Email (Ä‘á»ƒ gá»­i OTP)
  - `hashed_password`: Máº­t kháº©u Ä‘Ã£ mÃ£ hÃ³a
  - `role`: Vai trÃ² (DEAN, LECTURER, STUDENT)
  - `is_active`: Tráº¡ng thÃ¡i hoáº¡t Ä‘á»™ng

---

## TÃ“M Táº®T PHáº¦N 1

Trong pháº§n nÃ y, chÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu:

1. âœ… **Há»‡ thá»‘ng LMS** lÃ  gÃ¬ vÃ  táº¡i sao cáº§n báº£o máº­t
2. âœ… **OTP vÃ  2FA** lÃ  gÃ¬, hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o
3. âœ… **Táº¡i sao** trÆ°á»Ÿng khoa cáº§n OTP (quyá»n cao, rá»§i ro lá»›n)
4. âœ… **Kiáº¿n trÃºc há»‡ thá»‘ng** (Frontend, Backend, Database, Email)
5. âœ… **CÃ¡c thÃ nh pháº§n chÃ­nh** trong code

**Tiáº¿p theo**: Pháº§n 2 sáº½ giáº£i thÃ­ch **LUá»’NG HOáº T Äá»˜NG CHI TIáº¾T** tá»«ng bÆ°á»›c má»™t, tá»« khi ngÆ°á»i dÃ¹ng nháº­p username/password Ä‘áº¿n khi nháº­n Ä‘Æ°á»£c JWT token.

---

**ğŸ“„ Xem tiáº¿p**: `BAO_CAO_BAO_MAT_OTP_TRUONG_KHOA_PHAN_2_LUONG_HOAT_DONG.md`

